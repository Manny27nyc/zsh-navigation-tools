# Copy this file into /usr/share/zsh/[-version-]/functions
# and add 'autoload v-options` to .zshrc
#
# This function allows to browse and toggle shell's options
#
# Uses n-list

#emulate -L zsh

zmodload zsh/curses
local IFS="
"

# TODO restore options
unsetopt localoptions
setopt kshoptionprint

local list
local selected
local option
local state

VLIST_REMEMBER_STATE=1
unset VLIST_FROM_WHAT_IDX_LIST_IS_SHOWN
unset VLIST_CURRENT_IDX_OF_THE_LIST
VLIST_FROM_WHAT_IDX_LIST_IS_SHOWN=1
VLIST_CURRENT_IDX_OF_THE_LIST=1

while (( 1 )); do
    list=( `setopt` )
    list=( "${(@M)list:#*$1*}" )

    if [ "$#list" -eq 0 ]; then
        echo "No matching options"
        break
    fi

    list=( "${(@i)list}" )
    n-list "${list[@]}"

    if [ "$REPLY" -gt 0 ]; then
        selected="$list[$REPLY]"
        option="${selected%% *}"
        state="${selected##* }"

        # Toggle the option
        if [ "$state" = "on" ]; then
            echo "Setting |$option| to off"
            unsetopt "$option"
        else
            echo "Setting |$option| to on"
            setopt "$option"
        fi
    else
        break
    fi
done

VLIST_REMEMBER_STATE=0

# vim: set filetype=zsh:
